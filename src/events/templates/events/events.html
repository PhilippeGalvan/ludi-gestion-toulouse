{% extends 'base.html' %}
{% load static %}

{% block title %}Ludi Gestion - Evènements{% endblock %}

{% block content %}
<div>
    <link rel="stylesheet" href="{% static "css/events.css" %}" />
        {% for event in events %}
        <div class="event">
            <div>
                <p>{{ event.name }} le {{ event.date_french_format }}</p>
                <p>{{ event.description }}</p>
            </div>
            <div>
                {% if user not in event.candidates %}
                <form action="{% url 'events:register-member' %}" method="post">
                    {% csrf_token %}
                    <input type="hidden" name="event_uuid" value="{{ event.pk }}">
                    <button type="submit">
                        S'inscrire
                    </button>
                </form>
                {% else %}
                    {% for candidacy in event.candidacies.all %}
                        {% if user in candidacy.candidates.all %}
                            <p>{{ candidacy.candidates.all }}</p>
                            <form action="{% url 'events:unregister-member' %}" method="post">
                                {% csrf_token %}
                                <input type="hidden" name="event_uuid" value="{{ event.pk }}">
                                <input type="hidden" name="candidacy_uuid" value="{{ candidacy.pk }}">
                                <button type="submit">
                                    Se désinscrire
                                </button>
                            </form>
                        {% endif %}
                    {% endfor %}
                {% endif %}
            </div>
        </div>
        {% endfor %}
</div>
{% endblock %}
